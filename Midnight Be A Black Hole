local Rayfield = loadstring(game:HttpGet("https://raw.githubusercontent.com/shlexware/Rayfield/main/source"))()

local Window = Rayfield:CreateWindow({
    Name = "Farm Assistant",
    LoadingTitle = "Initializing...",
    LoadingSubtitle = "Please wait",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "FarmAssistantConfigs", -- You can change this
        FileName = "FarmSettings"
    },
    Discord = {
        Enabled = false
    },
    KeySystem = false
})

-- Services
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")
local RemoteFunction = ReplicatedStorage.Remotes.RemoteFunction

-- Variables
local player = Players.LocalPlayer
local farming = false
local randomDelays = true
local antiAFK = true
local safeMode = true

-- Objects to Farm
local objectsToConsume = {
    {"QuantumFlowers", "Map.newflowers.QuantumFlowers.Hitbox"},
    {"TreeTrunk", "Map.TreeTrunks.TreeTrunk.Hitbox"},
    {"Wolf", "Map.Wolfs.Wolf.Hitbox"},
    {"Car", "Map.Cars.Car.Hitbox"},
    {"MediumTree", "Map.MediumTrees.MediumTree.Hitbox"},
    {"Bush", "Map.Bushes:FindFirstChild('Decoration-Bush').Hitbox"},
    {"Cat", "Map.Cats.Cat.Hitbox"},
    {"Bench", "Map.Benches.Bench.Hitbox"},
    {"Dog", "Map.Dogs.Dog.Hitbox"},
    {"RoadLight", "Map.RoadLights.RoadLight.Hitbox"},
    {"Cactus", "Map.Cactus.Model.Hitbox"},
    {"BeachChair", "Map.BeachChairs.BeachChairWithUmbrella.Hitbox"},
    {"SmallHouse", "Map.SmallHouses.SmallBuilding.Hitbox"}
}

-- Utility Functions
local function getRandomDelay()
    return randomDelays and math.random(100, 300) / 100 or 1
end

local function getObjectFromPath(path)
    local object = workspace
    for _, part in ipairs(path:split(".")) do
        if part:find(":") then
            local funcName, arg = part:match("([^:]+):([^:]+)")
            if funcName and arg then
                arg = arg:gsub("'", "")
                object = object[funcName](object, arg)
            end
        else
            object = object[part]
        end
        if not object then
            warn("Invalid path:", path)
            return nil
        end
    end
    return object
end

local function consumeObject(objectPath)
    if not farming then return end

    local success, error = pcall(function()
        local object = getObjectFromPath(objectPath)
        if object then
            RemoteFunction:InvokeServer("ConsumeObject", object)
        end
    end)

    if not success then
        warn("Error consuming object:", error)
        if safeMode then
            wait(math.random(5, 10))
        end
    end
end

-- Farming Logic
local function startFarming()
    while farming do
        for _, objectInfo in ipairs(objectsToConsume) do
            if not farming then break end
            consumeObject(objectInfo[2])
            wait(getRandomDelay())
        end
        wait(math.random(4, 7)) -- Delay between cycles
    end
end

-- Anti-AFK
player.Idled:Connect(function()
    if antiAFK then
        VirtualUser:Button2Down(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
        wait(0.1)
        VirtualUser:Button2Up(Vector2.new(0, 0), workspace.CurrentCamera.CFrame)
    end
end)

-- UI Tabs and Sections
local FarmingTab = Window:CreateTab("Farming", 4483362458) -- Farming Icon
local SafetyTab = Window:CreateTab("Safety", 4483362458) -- Safety Icon

-- Farming Section
local farmingToggle = FarmingTab:CreateToggle({
    Name = "Start/Stop Farming",
    CurrentValue = false,
    Flag = "FarmingToggle",
    Callback = function(state)
        farming = state
        if farming then
            Rayfield:Notify({
                Title = "Farming Started",
                Content = "The auto-farm is now active.",
                Duration = 5
            })
            coroutine.wrap(startFarming)()
        else
            Rayfield:Notify({
                Title = "Farming Stopped",
                Content = "The auto-farm has been stopped.",
                Duration = 5
            })
        end
    end
})

FarmingTab:CreateToggle({
    Name = "Random Delays",
    CurrentValue = true,
    Flag = "RandomDelays",
    Callback = function(state)
        randomDelays = state
    end
})

-- Safety Section
SafetyTab:CreateToggle({
    Name = "Anti AFK",
    CurrentValue = true,
    Flag = "AntiAFK",
    Callback = function(state)
        antiAFK = state
    end
})

SafetyTab:CreateToggle({
    Name = "Safe Mode",
    CurrentValue = true,
    Flag = "SafeMode",
    Callback = function(state)
        safeMode = state
    end
})

-- Keybind for Toggling UI
Rayfield:CreateKeybind({
    Name = "Toggle UI",
    CurrentKeybind = Enum.KeyCode.RightControl,
    HoldToInteract = false,
    Flag = "ToggleUI",
    Callback = function()
        Rayfield:Toggle()
    end
})
